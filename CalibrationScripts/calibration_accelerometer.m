% Positive X-axis
PosX_xa = [1.04 1.04 1.04 1.04 1.04 1.04 1.04 1.05 1.04 1.04 1.04 1.04 1.04 1.04 1.04 1.04 1.04 1.04 1.04 1.04 1.05 1.04 1.04 1.04 1.05 1.04 1.04 1.04 1.04 1.04];
PosX_ya = [0.05 0.06 0.05 0.05 0.05 0.05 0.05 0.05 0.04 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05 0.05];
PosX_za = [-0.01 -0.01 -0.01 -0.01 -0.01 -0.01 -0.00 -0.01 -0.00 -0.01 -0.01 -0.01 -0.03 -0.03 -0.01 -0.02 -0.02 -0.02 -0.02 -0.02 -0.02 -0.02 -0.02 -0.02 -0.02 -0.01 -0.02 -0.02 -0.02 -0.01];

% Negative X-axis
NegX_xa = [-0.98 -0.99 -1.00 -0.99 -0.99 -0.98 -0.99 -0.99 -0.99 -1.00 -1.00 -0.99 -0.99 -0.99 -1.00 -0.99 -1.00 -1.00 -0.99 -0.99 -0.99 -0.99 -1.00 -0.99 -1.00 -0.99 -0.99 -0.99 -1.00 -0.99 -0.99];
NegX_ya = [ 0.05  0.05  0.05  0.05  0.05  0.05  0.05  0.05  0.05  0.05  0.05  0.04  0.05  0.05  0.05  0.05  0.05  0.04  0.06  0.04  0.06  0.05  0.04  0.04  0.05  0.04  0.05  0.05  0.05  0.04  0.05];
NegX_za = [ 0.06  0.05  0.06  0.06  0.05  0.07  0.06  0.05  0.06  0.04  0.05  0.05  0.05  0.05  0.06  0.06  0.05  0.04  0.05  0.06  0.07  0.05  0.05  0.07  0.07  0.05  0.06  0.07  0.07  0.07  0.07];

% Positive Y-axis
PosY_xa = [0.03 0.02 0.03 0.02 0.02 0.02 0.03 0.03 0.02 0.02 0.02 0.03 0.02 0.04 0.02 0.02 0.02 0.03 0.03 0.03 0.03 0.04 0.02 0.01 0.03 0.02 0.05 0.05 0.04 0.04 0.02 0.04 0.03];
PosY_ya = [1.06 1.05 1.06 1.05 1.05 1.06 1.05 1.05 1.06 1.05 1.06 1.06 1.06 1.05 1.05 1.05 1.06 1.05 1.05 1.06 1.05 1.05 1.05 1.06 1.06 1.07 1.06 1.07 1.05 1.06 1.06 1.06 1.05];
PosY_za = [0.01 0.02 0.01 0.01 0.01 0.01 0.02 0.02 0.00 0.02 0.03 0.00 0.02 0.02 0.00 0.00 -0.02 0.00 0.00 0.00 0.00 0.00 0.00 0.01 0.01 0.00 0.00 0.03 0.01 0.01 0.01 -0.00 0.01];


% Negative Y-axis
NegY_xa = [-0.05 -0.05 -0.04 -0.05 -0.05 -0.05 -0.05 -0.04 -0.04 -0.05 -0.04 -0.05 -0.05 -0.05 -0.05 -0.04 -0.05 -0.05 -0.05 -0.05 -0.06 -0.05 -0.05 -0.05 -0.05 -0.05 -0.05 -0.05 -0.05 -0.05];
NegY_ya = [-0.94 -0.94 -0.94 -0.94 -0.94 -0.94 -0.94 -0.93 -0.94 -0.94 -0.94 -0.94 -0.95 -0.94 -0.94 -0.94 -0.93 -0.94 -0.94 -0.94 -0.94 -0.95 -0.94 -0.94 -0.95 -0.94 -0.93 -0.94 -0.94 -0.94];
NegY_za = [ 0.01  0.01  0.01  0.02  0.02  0.02  0.01  0.01  0.01  0.01  0.02  0.01  0.01  0.02  0.01  0.01  0.02  0.02  0.01  0.02  0.02  0.02  0.02  0.02  0.02  0.01  0.02  0.02  0.01  0.02];

% Positiv Z-axis
PosZ_xa = [0.06 0.06 0.05 0.07 0.06 0.06 0.06 0.06 0.06 0.05 0.06 0.07 0.06 0.06 0.05 0.06 0.07 0.06 0.07 0.06 0.06 0.06 0.06 0.06 0.07 0.06 0.07 0.06 0.07 0.07 0.06 0.07 0.07 0.07];
PosZ_ya = [0.06 0.08 0.04 0.07 0.06 0.06 0.06 0.06 0.06 0.06 0.07 0.06 0.06 0.06 0.08 0.05 0.06 0.06 0.05 0.06 0.05 0.05 0.06 0.06 0.06 0.06 0.06 0.06 0.06 0.06 0.06 0.06 0.06 0.06];
PosZ_za = [1.00 1.00 1.00 1.00 0.99 0.99 0.99 0.99 1.00 0.99 0.98 0.99 1.00 1.00 0.99 0.99 0.99 0.99 0.99 0.99 0.99 1.00 0.99 0.99 0.99 0.99 1.00 1.00 0.99 0.99 1.00 1.00 0.99 0.99];


% Negative Z-axis
NegZ_xa = [0.02 0.01 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.02 0.01 0.02 0.01 0.02 0.02 0.02 0.02 0.01 0.02 0.02 0.01 0.01 0.02 0.01 0.02 0.02 0.02 0.02 0.01 0.02 0.02 0.02 0.01];
NegZ_ya = [0.05 0.06 0.06 0.06 0.06 0.06 0.06 0.06 0.06 0.07 0.06 0.06 0.06 0.06 0.06 0.06 0.06 0.06 0.07 0.06 0.06 0.06 0.06 0.06 0.06 0.06 0.06 0.06 0.06 0.07 0.06 0.07 0.06 0.06];
NegZ_za = [-0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95 -0.95];


meanPosX_Xa = mean(PosX_xa);meanPosX_Ya = mean(PosX_ya);meanPosX_Za = mean(PosX_za);
meanNegX_Xa = mean(NegX_xa);meanNegX_Ya = mean(NegX_ya);meanNegX_Za = mean(NegX_za);
meanPosY_Xa = mean(PosY_xa);meanPosY_Ya = mean(PosY_ya);meanPosY_Za = mean(PosY_za);
meanNegY_Xa = mean(NegY_xa);meanNegY_Ya = mean(NegY_ya);meanNegY_Za = mean(NegY_za);
meanPosZ_Xa = mean(PosZ_xa);meanPosZ_Ya = mean(PosZ_ya);meanPosZ_Za = mean(PosZ_za);
meanNegZ_Xa = mean(NegZ_xa);meanNegZ_Ya = mean(NegZ_ya);meanNegZ_Za = mean(NegZ_za);

meanPosX = [meanPosX_Xa, meanPosX_Ya, meanPosX_Za];meanNegX = [meanNegX_Xa, meanNegX_Ya, meanNegX_Za];
meanPosY = [meanPosY_Xa, meanPosY_Ya, meanPosY_Za];meanNegY = [meanNegY_Xa, meanNegY_Ya, meanNegY_Za];
meanPosZ = [meanPosZ_Xa, meanPosZ_Ya, meanPosZ_Za];meanNegZ = [meanNegZ_Xa,meanNegZ_Ya,meanNegZ_Za];


% Measured matrix
measured = [
    meanPosX;
    meanNegX;
    meanPosY;
    meanNegY;
    meanPosZ;
    meanNegZ
];

% Reference matrix in g
reference = [
    1  0  0;
   -1  0  0;
    0  1  0;
    0 -1  0;
    0  0  1;
    0  0 -1
];


%%

% Add a column of ones to add a bias term
measured_biasmatrix = [measured, ones(6, 1)];

% Solve least squares: A' = measured \ reference;
A_transpose = measured_biasmatrix \ reference;

% Transpose to get A (3x4)
A = A_transpose';

disp(A)


%%
ref_fitted = (A * measured_biasmatrix')';  

residuals = reference - ref_fitted;
squared_errors = residuals.^2;
mse_per_axis = mean(squared_errors);
rmse = sqrt(mean(squared_errors));
disp(rmse);
